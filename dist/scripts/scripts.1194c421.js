"use strict";function SpeechRecognitionException(a){this.name="SpeechRecognitionException",this.message=a}angular.module("wavesApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ui.router","puigcerber.capitalize","ngHolder"]).config(["$stateProvider","$routeProvider",function(a,b){b.otherwise({redirectTo:"/active_screen"}),a.state("home",{url:"/",views:{content:{templateUrl:"views/boot.html"}}}).state("active_screen",{url:"/active_screen",views:{top_left_content:{template:"<holliday-detail/>"},top_right_content:{template:"<forecast-detail/>"},content:{templateUrl:"views/active_screen/main.html"}}}).state("talk",{url:"/talk",views:{content:{template:"<voice-wave/>"}}}).state("waiting_response",{url:"/waiting_response",views:{content:{template:"<loading/>"}}}).state("news",{url:"/news",views:{content:{template:"<news-response/>"}}}).state("events",{url:"/events",views:{content:{template:"<events-response/>"}}}).state("weather",{url:"/weather",views:{content:{template:"<weather-response/>"}}})}]),angular.module("wavesApp").run(["$rootScope","speechSynthesis","speechRecognition","$state","$timeout",function(a,b,c,d,e){a.speechResult={},a.speechWasEnded=!1;try{a.speechRecognition=c.init({lang:"es-AR"},{onspeechstart:function(b){a.speechResult={},d.go("talk"),a.$emit("speechstart")},onresult:function(c){var f=a.speechRecognition.filterResult(c);a.speechResult.isInterim=!f.final,a.speechResult.result=f.text,f.final&&(b.say(f.text,{lang:"es-AR"}),a.speechRecognition.stop(),a.speechResult.stopSpeech=!0,e(function(){d.go("waiting_response")},1e3))},onend:function(b){a.speechWasEnded&&(d.go("active_screen"),a.speechWasEnded=!1),a.speechRecognition.stop(),a.speechResult.stopSpeech||(a.speechRecognition.start(),a.speechWasEnded=!a.speechWasEnded)},onerror:function(b){a.speechResult.noSpeech="no-speech"===b.error}}),a.speechRecognition.start()}catch(b){a.speechResult.result=b.message,a.speechResult.speechRecognitionNotSupported=!0}a.$on("$stateChangeStart",function(b,c,d,e,f){if(e.name!=c.name&&"active_screen"==c.name&&a.speechRecognition&&a.speechRecognition.isStopped())try{a.speechRecognition.start()}catch(a){console.warn(a)}})}]),angular.module("ngLocale",[],["$provide",function(a){var b={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};a.value("$locale",{DATETIME_FORMATS:{AMPMS:["a. m.","p. m."],DAY:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],ERANAMES:["antes de Cristo","después de Cristo"],ERAS:["a. C.","d. C."],FIRSTDAYOFWEEK:6,MONTH:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],SHORTDAY:["dom.","lun.","mar.","mié.","jue.","vie.","sáb."],SHORTMONTH:["ene.","feb.","mar.","abr.","may.","jun.","jul.","ago.","sept.","oct.","nov.","dic."],STANDALONEMONTH:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],WEEKENDRANGE:[5,6],fullDate:"EEEE, d 'de' MMMM 'de' y",longDate:"d 'de' MMMM 'de' y",medium:"d MMM y h:mm:ss a",mediumDate:"d MMM y",mediumTime:"h:mm:ss a",short:"d/M/yy h:mm a",shortDate:"d/M/yy",shortTime:"h:mm a"},NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-¤",negSuf:"",posPre:"¤",posSuf:""}]},id:"es-ar",localeID:"es_AR",pluralCat:function(a,c){return 1===a?b.ONE:b.OTHER}})}]),angular.module("wavesApp").service("speechSynthesis",["$window",function(a){var b=a.speechSynthesis,c={lang:"en-US",voiceIndex:1};return{say:function(d,e){var f=new a.SpeechSynthesisUtterance;e=angular.extend({},c,e),f.text=d,f.lang=e.lang,f.voice=b.getVoices().filter(function(a){return a.lang.indexOf(e.lang.split("-")[0])>=0})[e.voiceIndex],b.speak(f)}}}]),angular.module("wavesApp").controller("TimeCtrl",["$scope","$interval",function(a,b){var c=function(){a.clock=Date.now()};c(),b(c,1e3)}]),angular.module("wavesApp").controller("HollidaysCtrl",["$scope",function(a){a.hollidays=[{desc:"Feriado 1",days:5},{desc:"Feriado 2",days:4},{desc:"Feriado 3",days:3},{desc:"Feriado 4",days:2},{desc:"Feriado 5",days:1}]}]),angular.module("wavesApp").controller("WeatherCtrl",["$scope",function(a){a.weatherToday={day:new Date((new Date).getTime()+0),min:"15.0",max:"19.0",icon:"day-sunny"},a.forecast=[{day:new Date((new Date).getTime()+864e5),min:"15.0",max:"19.0",icon:"day-sunny"},{day:new Date((new Date).getTime()+1728e5),min:"15.0",max:"19.0",icon:"day-sunny"},{day:new Date((new Date).getTime()+2592e5),min:"15.0",max:"19.0",icon:"day-sunny"},{day:new Date((new Date).getTime()+3456e5),min:"15.0",max:"19.0",icon:"day-sunny"},{day:new Date((new Date).getTime()+432e6),min:"15.0",max:"19.0",icon:"day-sunny"}]}]),angular.module("wavesApp").controller("CommunicatorCtrl",["$scope",function(a){a.validActions=[{name:"Eventos",state:"events"},{name:"Clima",state:"weather"},{name:"Noticias",state:"news"},{name:"Voz",state:"talk"}]}]),angular.module("wavesApp").controller("NewsCtrl",["$scope","$interval","$timeout",function(a,b,c){a.pageSize=10,a.news={latest:["Noticia1Noticia1Noticia1Noticia1Noticia1Noticia1Noticia1Noticia1Noticia1","Noticia2Noticia2Noticia2Noticia2Noticia2Noticia2Noticia2Noticia2Noticia2","Noticia3Noticia3Noticia3Noticia3Noticia3Noticia3Noticia3Noticia3Noticia3","Noticia4Noticia4Noticia4Noticia4Noticia4Noticia4Noticia4Noticia4Noticia4","Noticia5Noticia5Noticia5Noticia5Noticia5Noticia5Noticia5Noticia5Noticia5","Noticia6Noticia6Noticia6Noticia6Noticia6Noticia6Noticia6Noticia6Noticia6","Noticia7Noticia7Noticia7Noticia7Noticia7Noticia7Noticia7Noticia7Noticia7","Noticia8Noticia8Noticia8Noticia8Noticia8Noticia8Noticia8Noticia8Noticia8","Noticia9Noticia9Noticia9Noticia9Noticia9Noticia9Noticia9Noticia9Noticia9","Noticia10Noticia10Noticia10Noticia10Noticia10Noticia10Noticia10Noticia10"],current:"",currentIndex:0,show:!0},b(function(){a.news.show=!1,a.news.currentIndex=(a.news.currentIndex+1)%a.news.latest.length,c(function(){a.news.current=a.news.latest[a.news.currentIndex],a.news.show=!0},500),0===a.news.currentIndex&&console.log("WAVES::Request new news page")},1e4)}]),angular.module("wavesApp").directive("communicator",function(){return{templateUrl:"views/directives/communicator.html",replace:!0,restrict:"E",controller:"CommunicatorCtrl"}}),angular.module("wavesApp").directive("newsBar",function(){return{templateUrl:"views/directives/news_bar.html",replace:!0,restrict:"E",controller:"NewsCtrl"}}),angular.module("wavesApp").directive("hollidayDetail",function(){return{templateUrl:"views/directives/hollidays_detail.html",replace:!0,restrict:"E",controller:"HollidaysCtrl"}}),angular.module("wavesApp").directive("newsResponse",function(){return{templateUrl:"views/directives/responses/news.html",replace:!0,restrict:"E",controller:"NewsCtrl"}}),angular.module("wavesApp").directive("eventsResponse",function(){return{templateUrl:"views/directives/responses/events.html",replace:!0,restrict:"E",controller:"EventsCtrl"}}),angular.module("wavesApp").directive("weatherResponse",function(){return{templateUrl:"views/directives/responses/weather.html",replace:!0,restrict:"E",controller:"WeatherCtrl"}}),angular.module("wavesApp").directive("forecastDetail",function(){return{templateUrl:"views/directives/forecast_detail.html",replace:!0,restrict:"E",controller:"WeatherCtrl"}}),angular.module("wavesApp").controller("BootCtrl",["$scope","$timeout","$state","$window","InflectionsAPIService",function(a,b,c,d,e){function f(){var a={};e.getInitialData("hollidays",5).then(function(b){a.hollidays=b.data.hollidays}),e.getInitialData("forecast",5).then(function(b){a.forecast=b.data.forecast}),e.getInitialData("news",10).then(function(b){a.news=b.data.news}),e.getInitialData("grammars").then(function(b){a.grammars=b.data.grammars}),c.go("active_screen",a)}b(f,2e3)}]),angular.module("wavesApp").directive("bootWave",function(){return{template:'<div id="boot-wave"></div>',restrict:"E",replace:!0,controller:"BootCtrl",link:function(a,b){b.text("Booting...")}}}),angular.module("wavesApp").directive("clock",function(){return{templateUrl:"views/directives/clock.html",replace:!0,restrict:"E",controller:"TimeCtrl",controllerAs:"time"}}),angular.module("wavesApp").directive("loading",function(){return{templateUrl:"views/directives/loading.html",replace:!0,restrict:"E",controller:"TalkCtrl"}}),angular.module("wavesApp").service("speechRecognition",["$window",function(a){var b,c={continuous:!1,interimResults:!0,lang:"en-US"};return{init:function(d,e){if(a.SpeechRecognition=a.webkitSpeechRecognition||a.SpeechRecognition,void 0!==SpeechRecognition)return b=new a.SpeechRecognition,d=angular.extend({},c,d,e),Object.assign(b,d),b._started=!1,this;throw new SpeechRecognitionException("Unable to initialize SpeechRecognizer. HTML5 SpeechRecognition not supported on your browser. ")},start:function(){if(!b)throw new SpeechRecognitionException("Unable to start recognizer. Initialize the recognizer first!");b.start(),b._started=!0},stop:function(){if(!b)throw new SpeechRecognitionException("Unable to start recognizer. Initialize the recognizer first!");b.stop(),b._started=!1},isStarted:function(){return b._started},isStopped:function(){return!b._started},abort:function(){if(!b)throw new SpeechRecognitionException("Unable to start recognizer. Initialize the recognizer first!");b.abort(),b._started=!1},filterResult:function(a){if(a&&a.results){var b=a.results[a.resultIndex];return{text:b[0].transcript,confidence:b[0].confidence,final:b.isFinal}}}}}]),angular.module("wavesApp").controller("TalkCtrl",["$rootScope","$scope","$state","InflectionsAPIService",function(a,b,c,d){d.sendRecognition(a.speechResult.result).then(function(){console.info(arguments)},function(){console.error(arguments)})}]),angular.module("wavesApp").directive("voiceWave",function(){return{templateUrl:"views/directives/voice_wave.html",replace:!0,restrict:"E"}}),angular.module("wavesApp").service("InflectionsAPIService",["$http",function(a){return{getInitialData:function(b,c){return a({method:"POST",url:"/",data:{key:b,limit:c}})},sendRecognition:function(b){return a({method:"POST",url:"/",data:b})}}}]),angular.module("wavesApp").controller("EventsCtrl",["$scope",function(a){a.events=["Evento1","Evento2","Evento3","Evento4","Evento5","Evento6","Evento7"]}]),angular.module("wavesApp").run(["$templateCache",function(a){a.put("views/active_screen/main.html",'<div class="content-row"> <news-bar class="text-center navbar navbar-fixed-bottom"> </div>'),a.put("views/boot.html",'<div class="col-md-12"> <boot-wave class="text-center"> </div>'),a.put("views/directives/clock.html",'<div class="text-center time" ui-sref="active_screen"> <p class="time-day">{{ clock | date: \'fullDate\' | capitalize:\'all\' }} </p> <span class="time-hour-min">{{ clock | date:\'HH:mm\'}}</span> <span class="time-sec">{{ clock | date:\'ss\'}}</span> </div>'),a.put("views/directives/communicator.html",'<div class="col-md-12 communicator"> <div ng-repeat="act in validActions" class="text-right"> <a ui-sref="{{act.state}}">{{ act.name }}</a> </div> </div>'),a.put("views/directives/forecast_detail.html",'<div class="pull-right text-right weather"> <div class="row forecast-item" ng-repeat="weather in forecast"> <span class="col-md-offset-1 col-md-3 text-right weather-day">{{ weather.day | date: \'EEE\' | capitalize }}</span> <span class="col-md-1 weather-icon"><i class="wi wi-{{ weather.icon }}"></i></span> <span class="col-md-3 weather-min-temp">{{ weather.min }}&deg;</span> <span class="col-md-3 weather-max-temp">{{ weather.max }}&deg;</span> </div> </div>'),a.put("views/directives/hollidays_detail.html",'<div class="hollidays"> <p ng-repeat="holliday in hollidays" class="holliday-item"> <span>{{ holliday.desc }}</span><span class="pull-right"> en {{ holliday.days }} dias</span> </p> </div>'),a.put("views/directives/loading.html",'<div class="text-center loading"> <i class="fa fa-circle-o-notch fa-spin fa-5x fa-fw"></i> </div>'),a.put("views/directives/news_bar.html",'<div class="col-md-12 newsContent news"> <p ng-repeat="notice in news.latest"> <span class="news-content" ng-show="$index == news.currentIndex && news.show"> <i class="fa fa-twitter"></i> {{notice}} </span> </p> </div>'),a.put("views/directives/responses/events.html",'<div class="col-md-offset-2 col-md-8 events-response"> <ul class="events-list list-group text-center"> <li ng-repeat="event in events" class="list-group-item"> <div class="media"> <!-- <div class="media-left">\n          <img class="media-object" holder="holder.js/64x64">\n        </div> --> <div class="media-body"> <h4 class="media-heading"><strong>{{event}}</strong></h4> <small> <em> Texto adicional de menor importancia </em> </small> </div> </div> </li> </ul> </div>'),a.put("views/directives/responses/news.html",'<div class="col-md-offset-2 col-md-8 news-response"> <ul class="news-list list-group text-center"> <li ng-repeat="notice in news.latest" class="list-group-item"> <div class="media"> <div class="media-left"> <img class="media-object" holder="holder.js/64x64"> </div> <div class="media-body"> <h4 class="media-heading"><strong>{{notice}}</strong> <i class="fa fa-twitter"></i></h4> <small> <em> Texto adicional de menor importancia </em> </small> </div> </div> </li> </ul> </div>'),a.put("views/directives/responses/weather.html",'<div class="col-md-offset-2 col-md-8 weather-response"> <div class="panel panel-default"> <div class="panel-body"> <h1> {{weatherToday.day | date: \'EEE\' | capitalize}} <i class="wi wi-{{weatherToday.icon}}"></i> </h1> ( {{weatherToday.min}}&deg; | {{weatherToday.max}}&deg; ) </div> </div> <ul class="weather-list list-group text-center"> <li ng-repeat="weather in forecast" class="list-group-item"> {{weather.day | date: \'EEE\' | capitalize }} <i class="wi wi-{{weather.icon}}"></i> ( {{weather.min}}&deg; | {{weather.max}}&deg; ) </li> </ul> </div>'),a.put("views/directives/voice_wave.html",'<div> <p> Hearing... </p> <div class="text-center navbar navbar-fixed-bottom"> <div class="col-md-12 talk" ng-class="{ notSupported : speechResult.speechRecognitionNotSupported}"> <i class="fa fa-microphone fa-4x"></i> <span class="talk-result"> <span ng-class="{ interim: speechResult.isInterim }">{{ speechResult.result }}</span> </span> </div> </div> </div>')}]);